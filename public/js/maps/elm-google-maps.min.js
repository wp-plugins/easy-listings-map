jQuery(function(f){var b=infoBubble=markerClusterer=null;var a=true;var e=[];function c(){if(b){return}var p=[];for(i=0,max=elm_google_maps.map_types.length;i<max;i++){if("ROADMAP"===elm_google_maps.map_types[i]){p.push(google.maps.MapTypeId.ROADMAP)}else{if("SATELLITE"===elm_google_maps.map_types[i]){p.push(google.maps.MapTypeId.SATELLITE)}else{if("HYBRID"===elm_google_maps.map_types[i]){p.push(google.maps.MapTypeId.HYBRID)}else{if("TERRAIN"===elm_google_maps.map_types[i]){p.push(google.maps.MapTypeId.TERRAIN)}}}}}if(!p.length){p.push(google.maps.MapTypeId.ROADMAP)}var q=new google.maps.LatLng(elm_google_maps.default_latitude,elm_google_maps.default_longitude);var m={zoom:parseInt(elm_google_maps.zoom),center:q,mapTypeControl:true,scrollwheel:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,mapTypeIds:p},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.DEFAULT}};b=new google.maps.Map(document.getElementById(elm_google_maps.map_id),m);infoBubble=g();var n=elm_google_maps.markers;n=jQuery.parseJSON(n);if(n.length){d(n);h()}if("1"===elm_google_maps.auto_zoom&&e.length){var o=new google.maps.LatLngBounds();for(i=0,max=e.length;i<max;i++){o.extend(e[i].getPosition())}b.setCenter(o.getCenter());b.fitBounds(o);a=false;b.setZoom(b.getZoom()-1>=0?b.getZoom()-1:b.getZoom());if(b.getZoom()>15){a=false;b.setZoom(15)}}else{if(e.length){b.setCenter(e[0].position)}}if("-1"!==elm_google_maps.limit){google.maps.event.addListener(b,"dragend",l);google.maps.event.addListener(b,"zoom_changed",l)}}if("object"===typeof google&&"object"===typeof google.maps){f(function(){if(f("#"+elm_google_maps.map_id).is(":visible")){c()}else{f('a[data-toggle="tab"]').on("shown shown.bs.tab",function(m){if(f("#"+elm_google_maps.map_id).is(":visible")){c()}});f("ul.ui-tabs-nav li, ul.z-tabs-nav li").on("click",function(m){if(f("#"+elm_google_maps.map_id).is(":visible")){c()}})}});google.maps.event.addDomListener(window,"resize",function(){if(b){var m=b.getCenter();google.maps.event.trigger(b,"resize");b.setCenter(m)}})}function k(m,n){return function(){var p=infoBubble.get("position");if(typeof p==="undefined"||(typeof p!=="undefined"&&m.position.lat()!==p.lat()&&m.position.lng()!==p.lng())){infoBubble.close();infoBubble=g();var o="";infoBubble.setCloseButtonStyle("margin-right","8px");if(n.info.length>1){for(i=0,max=n.info.length;i<max;i++){o='<div class="property-infobubble-content"><a href="'+decodeURIComponent(n.info[i].url)+'">'+n.info[i].image_url+'</a><div class="title"><a class="infobubble-property-title" href="'+decodeURIComponent(n.info[i].url)+'">'+n.info[i].title+'</a></div><div class="property-type-status">'+n.info[i].property_type+" - "+n.info[i].property_status+'</div><div class="property-feature-icons epl-clearfix">'+n.info[i].icons+"</div></div>";infoBubble.addTab(n.info[i].tab_title,o)}infoBubble.setCloseButtonStyle("margin-top","12px")}else{o='<div class="property-infobubble-content"><a href="'+decodeURIComponent(n.info[0].url)+'">'+n.info[0].image_url+'</a><div class="title"><a class="infobubble-property-title" href="'+decodeURIComponent(n.info[0].url)+'">'+n.info[0].title+'</a></div><div class="property-type-status">'+n.info[0].property_type+" - "+n.info[0].property_status+'</div><div class="property-feature-icons epl-clearfix">'+n.info[0].icons+"</div></div>";infoBubble.setContent(o);infoBubble.setCloseButtonStyle("margin-top","8px")}}if(!infoBubble.isOpen()){infoBubble.open(b,m)}}}function l(){if(!a){a=true;return}var p=b.getBounds();var o=p.getSouthWest();var r=p.getNorthEast();var q=o.lat();var m=o.lng();var s=r.lat();var n=r.lng();jQuery.ajax({type:"POST",url:elmPublicAjaxUrl,data:{action:"load_map_markers",nonce:elm_google_maps.nonce,southWestLat:q,southWestLng:m,northEastLat:s,northEastLng:n,post_type:elm_google_maps.post_type,status:elm_google_maps.status,order:elm_google_maps.order,cluster_size:elm_google_maps.cluster_size}}).done(function(t){t=jQuery.parseJSON(t);if(1===t.success){j();if(t.markers.length){d(t.markers);h()}}else{if(0===t.success){console.log(t.message)}}})}function j(){if(markerClusterer){markerClusterer.clearMarkers()}e=[]}function d(n){if(n.length){var m;for(i=0,max=n.length;i<max;i++){m=new google.maps.Marker({position:new google.maps.LatLng(n[i].latitude,n[i].longitude),icon:n[i]["marker_icon"]});e.push(m);google.maps.event.addListener(m,"click",k(m,n[i]))}}}function h(){if(e.length){var m=elm_google_maps.cluster_size==-1?null:parseInt(elm_google_maps.cluster_size,10);markerClusterer=new MarkerClusterer(b,e,{ignoreHidden:true,maxZoom:14,gridSize:m,styles:elm_google_maps.cluster_style});google.maps.event.addListener(markerClusterer,"click",function(n){console.log(n.getMarkers())})}}function g(){return new InfoBubble({maxWidth:300,maxHeight:300,closeSrc:elm_google_maps.info_window_close})}InfoBubble.prototype.setCloseButtonStyle=function(m,n){this.close_.style[m]=n}});
