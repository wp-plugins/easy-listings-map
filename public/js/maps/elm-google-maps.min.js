jQuery(function(e){var a=infoBubble=markerClusterer=null;var d=[];function b(){var o=[];for(i=0,max=elm_google_maps.map_types.length;i<max;i++){if("ROADMAP"===elm_google_maps.map_types[i]){o.push(google.maps.MapTypeId.ROADMAP)}else{if("SATELLITE"===elm_google_maps.map_types[i]){o.push(google.maps.MapTypeId.SATELLITE)}else{if("HYBRID"===elm_google_maps.map_types[i]){o.push(google.maps.MapTypeId.HYBRID)}else{if("TERRAIN"===elm_google_maps.map_types[i]){o.push(google.maps.MapTypeId.TERRAIN)}}}}}if(!o.length){o.push(google.maps.MapTypeId.ROADMAP)}var p=new google.maps.LatLng(elm_google_maps.default_latitude,elm_google_maps.default_longitude);var l={zoom:parseInt(elm_google_maps.zoom),center:p,mapTypeControl:true,scrollwheel:false,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DEFAULT,mapTypeIds:o},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.DEFAULT}};a=new google.maps.Map(document.getElementById(elm_google_maps.map_id),l);infoBubble=f();var m=elm_google_maps.markers;m=jQuery.parseJSON(m);if(m.length){c(m);g()}if("1"===elm_google_maps.auto_zoom&&d.length){var n=new google.maps.LatLngBounds();for(i=0,max=d.length;i<max;i++){n.extend(d[i].getPosition())}a.setCenter(n.getCenter());a.fitBounds(n);a.setZoom(a.getZoom()-1>=0?a.getZoom()-1:a.getZoom());if(a.getZoom()>15){a.setZoom(15)}}else{if(d.length){a.setCenter(d[0].position)}}google.maps.event.addListener(a,"dragend",k);google.maps.event.addListener(a,"zoom_changed",k)}if("object"===typeof google&&"object"===typeof google.maps){google.maps.event.addDomListener(window,"load",b)}function j(l,m){return function(){var o=infoBubble.get("position");if(typeof o==="undefined"||(typeof o!=="undefined"&&l.position.lat()!==o.lat()&&l.position.lng()!==o.lng())){infoBubble.close();infoBubble=f();var n="";infoBubble.setCloseButtonStyle("margin-right","8px");if(m.info.length>1){for(i=0,max=m.info.length;i<max;i++){n='<div class="property-infobubble-content"><a href="'+decodeURIComponent(m.info[i].url)+'">'+m.info[i].image_url+'</a><div class="title"><a class="infobubble-property-title" href="'+decodeURIComponent(m.info[i].url)+'">'+m.info[i].title+'</a></div><div class="property-type-status">'+m.info[i].property_type+" - "+m.info[i].property_status+'</div><div class="property-feature-icons epl-clearfix">'+m.info[i].icons+"</div></div>";infoBubble.addTab(m.info[i].tab_title,n)}infoBubble.setCloseButtonStyle("margin-top","12px")}else{n='<div class="property-infobubble-content"><a href="'+decodeURIComponent(m.info[0].url)+'">'+m.info[0].image_url+'</a><div class="title"><a class="infobubble-property-title" href="'+decodeURIComponent(m.info[0].url)+'">'+m.info[0].title+'</a></div><div class="property-type-status">'+m.info[0].property_type+" - "+m.info[0].property_status+'</div><div class="property-feature-icons epl-clearfix">'+m.info[0].icons+"</div></div>";infoBubble.setContent(n);infoBubble.setCloseButtonStyle("margin-top","8px")}}if(!infoBubble.isOpen()){infoBubble.open(a,l)}}}function k(){var o=a.getBounds();var n=o.getSouthWest();var q=o.getNorthEast();var p=n.lat();var l=n.lng();var r=q.lat();var m=q.lng();jQuery.ajax({type:"POST",url:elmPublicAjaxUrl,data:{action:"load_map_markers",nonce:elm_google_maps.nonce,southWestLat:p,southWestLng:l,northEastLat:r,northEastLng:m,post_type:elm_google_maps.post_type,status:elm_google_maps.status,order:elm_google_maps.order,cluster_size:elm_google_maps.cluster_size}}).done(function(s){s=jQuery.parseJSON(s);if(1===s.success){h();if(s.markers.length){c(s.markers);g()}}else{if(0===s.success){console.log(s.message)}}})}function h(){if(markerClusterer){markerClusterer.clearMarkers()}d=[]}function c(m){if(m.length){var l;for(i=0,max=m.length;i<max;i++){l=new google.maps.Marker({position:new google.maps.LatLng(m[i].latitude,m[i].longitude),icon:m[i]["marker_icon"]});d.push(l);google.maps.event.addListener(l,"click",j(l,m[i]))}}}function g(){if(d.length){var l=elm_google_maps.cluster_size==-1?null:parseInt(elm_google_maps.cluster_size,10);markerClusterer=new MarkerClusterer(a,d,{ignoreHidden:true,maxZoom:14,gridSize:l,styles:elm_google_maps.cluster_style});google.maps.event.addListener(markerClusterer,"click",function(m){console.log(m.getMarkers())})}}function f(){return new InfoBubble({maxWidth:300,maxHeight:300,closeSrc:elm_google_maps.info_window_close})}InfoBubble.prototype.setCloseButtonStyle=function(l,m){this.close_.style[l]=m}});
